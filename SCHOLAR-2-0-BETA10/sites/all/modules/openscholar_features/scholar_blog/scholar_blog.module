<?php

include_once('scholar_blog.features.inc');

/**
 * Implementation of hook_block
 */
function scholar_blog_block($op = 'list', $delta = false, $edit = array()){
  if ($op == 'list') {
    $blocks['rss']['info'] = t('RSS Feed - Link to subscribe to your newest blog entries');
    return $blocks;
  }
  elseif ($op == 'view') {
    switch ($delta) {
      case 'rss':
        return _scholar_blog_rss_wgt();
    }
  }
}

/**
 * Implementation of hook_context_links_alter().
 */
function scholar_blog_context_links_alter(&$links) {
  if (!empty($links['blog'])) {
    $links['blog']['query'] = drupal_get_destination();
  }
}

/**
 * hook link_alter (admin at the end of links)
 */
function scholar_blog_link_alter(&$links, $node){
  
  if (isset($links['blog_usernames_blog'])) {
    unset($links['blog_usernames_blog']);
  }
}


/**
 * Implementation of hook_strongarm().
 */
function scholar_blog_strongarm() {
  $conf = array();
 
  $conf['node_options_blog'] = array('status', 'revision');
  $conf['upload_blog'] = TRUE;
 
  // Comments
  $conf['comment_blog'] = COMMENT_NODE_READ_WRITE;
  $conf['comment_default_mode_blog'] = COMMENT_MODE_THREADED_EXPANDED;
  $conf['comment_default_order_blog'] = COMMENT_ORDER_OLDEST_FIRST;
  $conf['comment_default_per_page_blog'] = 10;
  $conf['comment_controls_blog'] = COMMENT_CONTROLS_HIDDEN;
  $conf['comment_anonymous_blog'] = COMMENT_ANONYMOUS_MAY_CONTACT;
  $conf['comment_subject_field_blog'] = 1;
  $conf['comment_preview_blog'] = COMMENT_PREVIEW_OPTIONAL;
  $conf['comment_form_location_blog'] = COMMENT_FORM_BELOW;
  //$conf['comment_upload_blog'] = TRUE;
 
  // diff / preview
  $conf["show_preview_changes_blog"] = TRUE;
  $conf["show_diff_inline_blog"] = FALSE;
  
  // Pathauto settings
  $conf["pathauto_node_blog_pattern"] = "[space-og-path]/blog/[yyyy]/[mm]/[title-raw]";
 
  $conf['node_submitted_info_blog'] = TRUE;
  
  $conf['nodeformscols_field_placements_blog_default'] = unserialize('a:13:{s:5:"title";a:4:{s:6:"region";s:4:"main";s:6:"weight";s:1:"0";s:12:"has_required";b:1;s:5:"title";s:5:"Title";}s:10:"body_field";a:5:{s:6:"region";s:4:"main";s:6:"weight";s:1:"1";s:12:"has_required";b:0;s:5:"title";N;s:6:"hidden";i:0;}s:4:"menu";a:6:{s:6:"region";s:5:"right";s:6:"weight";s:1:"1";s:12:"has_required";b:0;s:5:"title";s:13:"Menu settings";s:9:"collapsed";i:1;s:6:"hidden";i:0;}s:20:"revision_information";a:3:{s:6:"region";s:5:"right";s:6:"weight";s:1:"2";s:6:"hidden";i:0;}s:16:"comment_settings";a:6:{s:6:"region";s:5:"right";s:6:"weight";s:1:"7";s:12:"has_required";b:0;s:5:"title";s:16:"Comment settings";s:9:"collapsed";i:1;s:6:"hidden";i:0;}s:4:"path";a:6:{s:6:"region";s:5:"right";s:6:"weight";s:1:"6";s:12:"has_required";b:0;s:5:"title";s:17:"URL path settings";s:9:"collapsed";i:1;s:6:"hidden";i:0;}s:7:"options";a:6:{s:6:"region";s:5:"right";s:6:"weight";s:1:"4";s:12:"has_required";b:0;s:5:"title";s:18:"Publishing options";s:9:"collapsed";i:1;s:6:"hidden";i:0;}s:6:"author";a:6:{s:6:"region";s:5:"right";s:6:"weight";s:1:"3";s:12:"has_required";b:0;s:5:"title";s:21:"Authoring information";s:9:"collapsed";i:1;s:6:"hidden";i:0;}s:7:"buttons";a:5:{s:6:"region";s:4:"main";s:6:"weight";s:1:"4";s:12:"has_required";b:0;s:5:"title";N;s:6:"hidden";i:0;}s:4:"book";a:6:{s:6:"region";s:5:"right";s:6:"weight";s:1:"5";s:12:"has_required";b:0;s:5:"title";s:12:"Book outline";s:9:"collapsed";i:1;s:6:"hidden";i:0;}s:8:"taxonomy";a:5:{s:6:"region";s:5:"right";s:6:"weight";s:1:"0";s:12:"has_required";b:0;s:5:"title";N;s:6:"hidden";i:0;}s:11:"attachments";a:5:{s:6:"region";s:4:"main";s:6:"weight";s:1:"3";s:12:"has_required";b:0;s:5:"title";s:31:"Attach files to this blog entry";s:6:"hidden";i:0;}s:10:"og_nodeapi";a:6:{s:6:"region";s:4:"main";s:6:"weight";s:1:"2";s:12:"has_required";b:0;s:5:"title";s:9:"Web Sites";s:9:"collapsed";i:0;s:6:"hidden";i:0;}}');
  
  return $conf;
}

/**
 * Link to subscribe to the rss feed
 */
function _scholar_blog_rss_wgt(){
  
  return array('content' => l("Subscribe to this blog Feed","blog/feed",array('attributes' => array('class' => 'feed-link'))));
  
}
